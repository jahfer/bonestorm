<!doctype html>
<!--[if lt IE 9]><html class="ie"><![endif]-->
<!--[if gte IE 9]><!--><html><!--<![endif]-->

	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>

		<title></title>

		<link rel="stylesheet" href=""/>
		<link href='http://fonts.googleapis.com/css?family=VT323' rel='stylesheet' type='text/css'>

		<script src="http://bonestorm.jit.su/socket.io/socket.io.js"></script>
		<script src="/js/raphael-min.js"></script>

		<style>
			body, h1 { font-family: 'VT323', monospace; font-weight: 100!important; }
		</style>

		<!--[if lt IE 9]>
			<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>

	<body lang="en">
		<script>
			//var socket = io.connect('http://localhost');
			var socket = io.connect('http://bonestorm.jit.su');

			var paper = Raphael(100, 200, 600, 600);
			paper.image("/img/bg.png", 0, 0, 3600, 3600);

			paper.rect(0, 0, 1200, 1200);
			paper.rect(1200, 0, 1200, 1200);
			paper.rect(2400, 0, 1200, 1200);
			paper.rect(0, 1200, 1200, 1200);
			paper.rect(1200, 1200, 1200, 1200);
			paper.rect(2400, 1200, 1200, 1200);
			paper.rect(0, 2400, 1200, 1200);
			paper.rect(1200, 2400, 1200, 1200);
			paper.rect(2400, 2400, 1200, 1200);

			var PLAYERS = [];
			var ENEMIES = [];

			var User = function(id, x, y) {
				this.uid = id || -1;
				this.x = x || -10;
				this.y = y || -10;
				this.shape = paper.circle(this.x, this.y, 10).attr({fill: "#f00", stroke: "#fff"});
				this.speed = 5;
				this.weapon = "shotgun";
			}

			var Enemy = function(id, x, y) {
				this.uid = id || -1;
				this.x = x || -10;
				this.y = y || -10;
				this.shape = paper.circle(this.x, this.y, 10).attr({fill: "#000", stroke: "#fff"});
				this.speed = 5;
				this.weapon = "shotgun";
			}

			var player = new User();
			paper.image("/img/pipes.png", 0, 0, 3600, 3600);

			socket.emit('user:connect', 'Jahfer');
			socket.on('server:userSettings', function (data) {
				player.uid = data.id;
				player.x = data.coords.x;
				player.y = data.coords.y;
				player.shape.attr({cx: data.coords.x, cy: data.coords.y});
			});

			socket.on('user:disconnect', function (id) {
				PLAYERS[id].shape.remove();
				delete PLAYERS[id];
			});

			socket.on('user:move:pos', function (data) {
				if (typeof PLAYERS[data.id] != "undefined")
					PLAYERS[data.id].shape.attr({cx: data.x, cy: data.y});
				else
					PLAYERS[data.id] = new User(data.id, data.x, data.y);

				console.log(PLAYERS[data.id]);
			});

			socket.on('enemy:move:pos', function (data) {
				if (typeof ENEMIES[data.id] != "undefined")
					ENEMIES[data.id].shape.attr({cx: data.x, cy: data.y});
				else
					ENEMIES[data.id] = new Enemy(data.id, data.x, data.y);

				console.log(ENEMIES[data.id]);
			});

			document.addEventListener('keydown', function (e) {
				var evt = e ? e:event;
  				var keyCode = evt.keyCode;

  				switch (keyCode) {
  					// left
  					case 37: 
  						player.x -= player.speed;
	  					e.preventDefault();
  						break;
  					// up
  					case 38: 
  						player.y -= player.speed;
	  					e.preventDefault();
  						break;
  					// right
  					case 39: 
  						player.x += player.speed;
	  					e.preventDefault();
  						break;
  					// down
  					case 40: 
  						player.y += player.speed;
	  					e.preventDefault();
  						break;
  				}

				socket.emit('user:move:pos', {id: player.uid, x: player.x, y: player.y})
				player.shape.attr({cx: player.x, cy: player.y});
			});

		</script>

		<header id="page-header">
			<h1>BoneStorm</h1>
		</header>

		<div id="main">
			
		</div>

		<footer id="page-footer">
			<p>Copyright &copy; 2013 <a href="http://rbaylis.com">Russell Baylis</a> &middot; <a href="http://jahfer.com">Jahfer Husain</a> &middot; <a href="http://sunmock.com">Sunmock Yang</a> </p>
		</footer>

	</body>

</html>