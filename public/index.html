<!doctype html>
<!--[if lt IE 9]><html class="ie"><![endif]-->
<!--[if gte IE 9]><!--><html><!--<![endif]-->

	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>

		<title></title>

		<link rel="stylesheet" href=""/>

		<script src="/socket.io/socket.io.js"></script>
		<script src="/js/raphael-min.js"></script>

		<!--[if lt IE 9]>
			<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>

	<body lang="en">
		<script>
			//var socket = io.connect('http://localhost');
			var socket = io.connect('http://bonestorm.jit.su');

			var paper = Raphael(10, 50, 600, 600);
			var rect = paper.rect(0, 0, 600, 600);
			var PLAYERS = [];

			var User = function(id, x, y) {
				this.uid = id || -1;
				this.x = x || parseInt(Math.random() * 600, 10);
				this.y = y || parseInt(Math.random() * 600, 10);
				this.shape = paper.circle(this.x, this.y, 10).attr({fill: "#f00", stroke: "#fff"});
				this.speed = 5;
			}

			var player = new User();

			socket.emit('user:connect', 'Jahfer');
			socket.on('server:userId', function (id) {
				player.uid = id;
			});

			socket.on('user:move:pos', function (data) {
				if (typeof PLAYERS[data.id] != "undefined")
					PLAYERS[data.id].shape.attr({cx: data.x, cy: data.y});
				else
					PLAYERS[data.id] = new User(data.id, data.x, data.y);

				console.log(PLAYERS[data.id]);
			})

			document.addEventListener('keydown', function (e) {
				var evt = e ? e:event;
  				var keyCode = evt.keyCode;

  				switch (keyCode) {
  					// left
  					case 37:
  						player.x -= player.speed;
  						break;
  					// up
  					case 38:
  						player.y -= player.speed;
  						break;
  					// right
  					case 39:
  						player.x += player.speed;
  						break;
  					// down
  					case 40:
  						player.y += player.speed;
  						break;
  				}

				socket.emit('user:move:pos', {id: player.uid, x: player.x, y: player.y})
				player.shape.attr({cx: player.x, cy: player.y});

				e.preventDefault();
				return false;
			});

		</script>

	</body>

</html>